<analysis>
<original_problem_statement>
The user's latest set of requests focuses on correcting and finalizing the functionality of the **TC AD/SB Imported References** screen (). The core problems reported were that the View PDF and Remove actions were failing on iOS TestFlight.

**PRODUCT REQUIREMENTS:**

1.  **Fix PDF Viewing on iOS:**
    *   The View PDF action must correctly open the associated PDF.
    *   This requires an authenticated download because the endpoint is protected.
    *   The implementation must use  to download the PDF to the device's cache and  to open it, as  is not suitable for protected remote files on iOS.
    *   The correct API endpoint is . The frontend must use the  field from the baseline data for this call.

2.  **Fix Reference Deletion:**
    *   The Remove action must correctly delete the imported reference from the backend.
    *   The correct API endpoint is .
    *   The frontend must use the  field (an ObjectId string) from the baseline data for this call.
    *   After a successful deletion, the screen must automatically refresh its data by re-fetching the baseline.

3.  **UI/UX Finalization:**
    *   The screen must **only** display items from the baseline where . All other items (e.g., ) should be filtered out.
    *   A single, top-level button should link to the Transport Canada search page. Per-item links must be removed.
    *   Each item card must contain a View PDF button and a Remove button.
    *   Each card must include a static, TC-safe disclaimer: Imported reference for document review. This does not indicate compliance or airworthiness status.

</original_problem_statement>
**User's preferred language**: fran√ßais

**what currently exists?**
The application features a heavily modified AD/SB (Airworthiness Directives / Service Bulletins) module. The focus of recent work has been the  screen, which is intended to display a list of user-imported PDF references from Transport Canada (TC).

The agent has just finished an iteration of fixes on this screen:
-   It installed  and  to handle authenticated PDF downloads.
-   It rewrote the  handler to fetch the PDF data, save it to a local file, and use the sharing dialog to open it.
-   It updated the  handler.
-   Crucially, in the very last step, it corrected the API endpoints used in both handlers to  and  respectively.

The code for these fixes has been written, but the changes have not been tested or verified by the user.

**Last working item**:
- Last item agent was working: The agent was finalizing the fix for the View PDF and Remove functionalities on the TC AD/SB screen (). The last action was updating the API call URLs in the  and  handlers to use the correct endpoints ( and ) and the correct IDs ( and ).
- Status: IN PROGRESS
- Agent Testing Done: N
- Which testing method agent to use? Frontend testing agent
- User Testing Done: N

**All Pending/In progress Issue list**:
-   Issue 1: (P0) PDF Viewing and Deletion on the TC AD/SB screen might still be broken.
-   Issue 2: (P1) The main subscription screen is likely non-functional, displaying no subscription plans.

  Issues Detail:
  - Issue 1:
     - Attempted fixes: The agent has rewritten the handlers (, ) in  to use the correct IDs (, ) and the user-specified API endpoints. The PDF handler now uses  and  for a robust iOS implementation.
     - Next debug checklist:
        1.  Start the frontend application.
        2.  Navigate to an aircraft's maintenance section and then to the TC AD/SB screen (Page 2).
        3.  Assuming there are user-imported PDF references, tap the View PDF button on one of them.
        4.  **Expected:** The iOS share sheet should appear, allowing the user to view/save the PDF.
        5.  **If it fails:** Check the console/device logs for the exact URL being called by  and any error messages from the  call or  operations. Verify  is being passed correctly.
        6.  Tap the Remove button on an item.
        7.  **Expected:** The item should be removed from the list after a brief loading state, and the list should refresh.
        8.  **If it fails:** Check the console/device logs for the URL being called by  and the  being used. Verify the  request is correct.
     - Why fix this issue and what will be achieved with the fix? This is the user's current, highest-priority request. Fixing it will complete the Phase 1 implementation of the TC PDF import feature, making it a functional documentary reference tool.
     - Status:  IN PROGRESS
     - Is recurring issue? Y
     - Should Test frontend/backend/both after fix? frontend
     - Blocked on other issue: None
  - Issue 2:
     - Attempted fixes: The agent refactored the subscription screen () to use  from RevenueCat. This was a user requirement. However, the user then reported that no plans were visible. The agent correctly diagnosed that this is likely because no Current Offering is configured in the user's RevenueCat dashboard. The user then pivoted to a different task before this could be resolved.
     - Next debug checklist:
        1.  Advise the user to check their RevenueCat dashboard and set a Current Offering.
        2.  Alternatively, if the user wants to display plans from multiple named offerings, the code in  would need to be changed again to iterate through  instead of using .
     - Why fix this issue and what will be achieved with the fix? This is a critical bug that prevents users from subscribing. It needs to be resolved for the app to be commercially viable.
     - Status:  NOT STARTED
     - Is recurring issue? N
     - Should Test frontend/backend/both after fix? frontend
     - Blocked on other issue: User decision on how to proceed (configure RevenueCat vs. change code).

**In progress Task List**:
-   None

**Upcoming and Future Tasks**
-   None specified by the user. The immediate priority is to fix and verify the pending issues.

**Completed work in this session**
- **TC AD/SB Module Overhaul ():**
  - Performed a full audit of the module.
  - Applied multiple UX and TC-safe patches (clarified titles, updated labels, added alerts).
  - Implemented a Phase 1 PDF import feature using .
  - Repeatedly refactored the screen to filter and display only user-imported references.
  - Added View PDF, Remove, and Search TC actions.
  - Attempted to fix bugs related to the PDF viewing and deletion functionality.
- **Subscription Screen Refactor ():**
  - Completed a major refactor to dynamically display plans from  to meet Apple's guidelines.
  - Fixed a subsequent bug where legal links (Privacy/Terms) were not always visible by restructuring the component to have a persistent layout.

**Earlier issues found/mentioned but not fixed**
   - Issue 1: **Subscription screen shows no plans.** As detailed in Pending Issues, this screen was refactored but is likely not working because the user's RevenueCat account may not have a Current Offering configured. The user switched context before this was resolved.
   - Issue 2: **Web preview build failures.** The project has a known, pre-existing dependency issue with  that causes the Expo web preview to fail. The user has instructed to ignore this and focus on native iOS builds.

**Known issue recurrence from previous fork**
  - None

**Code Architecture**


**Key Technical Concepts**
- **Frontend:** React Native, Expo (SDK 54, Managed Workflow)
- **IAP:** RevenueCat ()
- **File Handling:** , , 
- **API Communication:** Axios for authenticated REST API calls (, , ).
- **State Management:** Component state (, ) and Zustand stores.
- **Styling:** 

**key DB schema**
- N/A (Frontend agent)

**changes in tech stack**
- , , and  were added to implement the PDF import and viewing functionality.

**All files of reference**
1.  ****: The primary file for the current task. Contains all logic for displaying, viewing, and deleting imported TC AD/SB PDF references.
2.  ****: Contains all localized strings (FR/EN) used in the UI, which was updated multiple times.
3.  ****: Contains a critical, unresolved issue where subscription plans may not be displayed.

**Areas that need refactoring**:
-    may need to be refactored again depending on the user's decision regarding the Current Offering issue.

**key api endpoints**
-   : Fetches the combined list of AD/SB items.
-   : Uploads a new PDF reference.
-   : **(New)** Downloads the content of a specific imported PDF.
-   : **(New)** Deletes a specific imported PDF reference.

**Critical Info for New Agent**
- **Verify the  fixes:** Your immediate task is to test the View PDF and Remove buttons on the TC AD/SB screen. The code has been written but is unverified. Follow the debug checklist.
- **Be prepared to address the Subscription screen:** The user has a major unresolved issue on the  screen. After the current task, you should remind the user of this problem and ask for direction on how to solve it (either they configure RevenueCat, or you modify the code).
- **Follow user instructions precisely:** The user provides very specific, iterative, and technically detailed requests, often including the exact API endpoints and implementation logic to use. Adherence is critical.
- **TC-Safe Language:** All UI changes related to the AD/SB module must use neutral, non-regulatory language (e.g., documentary reference, not an indication of compliance).

**documents created in this job**
- None

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Provided final, definitive API endpoints and IDs for fixing PDF and Delete actions. (IN PROGRESS)
2.  **Agent:** Confirmed understanding and started the fix. (COMPLETED)
3.  **User:** Reported PDF and Delete still broken, re-stating the required IDs (, ). (COMPLETED)
4.  **Agent:** Implemented fixes using the specified IDs and a more robust file download method. (COMPLETED)
5.  **User:** Reported PDF/Delete still not working and specified a new set of fixes (authenticated download, use of ). (COMPLETED)
6.  **Agent:** Implemented the fixes as requested. (COMPLETED)
7.  **User:** Requested final cleanup of the  screen UI/UX. (COMPLETED)
8.  **Agent:** Implemented the cleanup. (COMPLETED)
9.  **User:** Requested another major change to , to only show user-imported PDFs with specific actions. (COMPLETED)
10. **Agent:** Implemented the major UI change. (COMPLETED)

**Project Health Check:**
- **Broken:**
    - The View PDF and Remove features in  are likely broken pending verification of the latest fix.
    - The  screen is likely broken, showing no plans.
    - The Expo web preview is intermittently broken (known issue, to be ignored).
- **Mocked:** No components are currently mocked.

**3rd Party Integrations**
- **RevenueCat:** For iOS In-App Purchases, via .

**Testing status**
- Testing agent used after significant changes: NO
- Troubleshoot agent used after agent stuck in loop: NO
- Test files created: []
- Known regressions:
    - The View PDF and Remove features on  have been recurring issues.
    - The subscription screen is likely in a non-functional state after the last refactor.

**Credentials to test flow:**
- An API token is required for authenticated calls. The  service should handle this automatically.
- A RevenueCat API key is in the environment, but testing requires a properly configured Sandbox environment.

**What agent forgot to execute**
The agent did not forget to execute any tasks. It was actively working on the user's latest request. The major pending issue with the subscription screen was not forgotten but was deprioritized by a user-initiated context switch to the AD/SB module. The next agent should bring this back to the user's attention.
</analysis>
